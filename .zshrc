#====================================
# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®è¨­å®š
#------------------------------------
# è‰²ä¸€è¦§
#------------------------------------
# 00: ãªã«ã‚‚ã—ãªã„
# 01: å¤ªå­—åŒ–
# 04: ä¸‹ç·š
# 05: ç‚¹æ»…
# 07: å‰èƒŒè‰²åè»¢
# 08: è¡¨ç¤ºã—ãªã„
# 22: ãƒŽãƒ¼ãƒžãƒ«åŒ–
# 24: ä¸‹ç·šãªã—
# 25: ç‚¹æ»…ãªã—
# 27: å‰èƒŒè‰²åè»¢ãªã—
# 30: é»’(å‰æ™¯è‰²)
# 31: èµ¤(å‰æ™¯è‰²)
# 32: ç·‘(å‰æ™¯è‰²)
# 33: èŒ¶(å‰æ™¯è‰²)
# 34: é’(å‰æ™¯è‰²)
# 35: ãƒžã‚¼ãƒ³ã‚¿(å‰æ™¯è‰²)
# 36: ã‚·ã‚¢ãƒ³(å‰æ™¯è‰²)
# 37: ç™½(å‰æ™¯è‰²)
# 39: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ(å‰æ™¯è‰²)
# 40: é»’(èƒŒæ™¯è‰²)
# 41: èµ¤(èƒŒæ™¯è‰²)
# 42: ç·‘(èƒŒæ™¯è‰²)
# 43: èŒ¶(èƒŒæ™¯è‰²)
# 44: é’(èƒŒæ™¯è‰²)
# 45: ãƒžã‚¼ãƒ³ã‚¿(èƒŒæ™¯è‰²)
# 46: ã‚·ã‚¢ãƒ³(èƒŒæ™¯è‰²)
# 47: ç™½(èƒŒæ™¯è‰²)
# 49: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ(èƒŒæ™¯è‰²)
#------------------------------------
# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ
#------------------------------------
# %% %ã‚’è¡¨ç¤º
# %) )ã‚’è¡¨ç¤º
# %l ç«¯æœ«åçœç•¥å½¢
# %M ãƒ›ã‚¹ãƒˆå(FQDN)
# %m ãƒ›ã‚¹ãƒˆå(ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³)
# %n ãƒ¦ãƒ¼ã‚¶ãƒ¼å
# %y ç«¯æœ«å
# %# rootãªã‚‰#ã€ä»–ã¯%ã‚’è¡¨ç¤º
# %? ç›´å‰ã«å®Ÿè¡Œã—ãŸã‚³ãƒžãƒ³ãƒ‰ã®çµæžœã‚³ãƒ¼ãƒ‰
# %d ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª %/ ã§ã‚‚å¯
# %~ ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã®ãƒ‘ã‚¹
# %h ãƒ’ã‚¹ãƒˆãƒªç•ªå· %! ã§ã‚‚å¯
# %a The observed action, i.e. "logged on" or "logged off".
# %S (%s) åè»¢ãƒ¢ãƒ¼ãƒ‰ã®é–‹å§‹/çµ‚äº† %S abc %s ã¨ã™ã‚‹ã¨abcãŒåè»¢
# %U (%u) ä¸‹ç·šãƒ¢ãƒ¼ãƒ‰ã®é–‹å§‹/çµ‚äº† %U abc %u ã¨ã™ã‚‹ã¨abcã«ä¸‹ç·š
# %B (%b) å¼·èª¿ãƒ¢ãƒ¼ãƒ‰ã®é–‹å§‹/çµ‚äº† %B abc %b ã¨ã™ã‚‹ã¨abcã‚’å¼·èª¿
# %t æ™‚åˆ»è¡¨ç¤º(12æ™‚é–“å˜ä½ã€åˆå‰/åˆå¾Œã¤ã) %@ ã§ã‚‚å¯
# %T æ™‚åˆ»è¡¨ç¤º(24æ™‚é–“è¡¨ç¤º)
# %* æ™‚åˆ»è¡¨ç¤º(24æ™‚é–“è¡¨ç¤ºç§’ä»˜ã)
# %w æ—¥è¡¨ç¤º(dd) æ—¥æœ¬èªžã ã¨ æ›œæ—¥ æ—¥
# %W å¹´æœˆæ—¥è¡¨ç¤º(mm/dd/yy)
# %D å¹´æœˆæ—¥è¡¨ç¤º(yy-mm-dd)
#====================================
case ${UID} in
0)
    PROMPT="%{[31m%}%/%{[m%} %# "
    PROMPT2="%{[31m%}%/%{[m%} %# "
    SPROMPT="%B%{[31m%}%r is correct? [n,y,a,e]:%{[m%} %b "
    RPROMPT="%1(v|%F{green}%1v%f|)"
    [ -n "${REMOTEHOST}${SSH_CONNECTION}" ] && 
        PROMPT="%{[37m%}${HOST%%.*} ${PROMPT}"
    ;;
*)
    PROMPT="%{[$[32+$RANDOM % 5]m%}%/%{[m%} %# "
    PROMPT2="%{[31m%}%/%{[m%} %# "
    SPROMPT="%{[31m%}%r is correct? [n,y,a,e]:%{[m%} "
    RPROMPT="%1(v|%F{green}%1v%f|)"
    [ -n "${REMOTEHOST}${SSH_CONNECTION}" ] && 
        PROMPT="%{[37m%}${HOST%%.*} ${PROMPT}"
    ;;
esac

# loading alias config
source $HOME/dotfiles/shell.d/alias.sh

#====================================
# windowã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¨­å®šã™ã‚‹
#
# å‚è€ƒã«ã—ãŸã¨ã“ã‚
# - http://izawa.hatenablog.jp/entry/2012/09/18/220106
#
# preexec() ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œç›´å‰ã«å‘¼ã³å‡ºã•ã‚Œã‚‹
# precmd()  ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤ºç›´å‰ã«å‘¼ã³å‡ºã•ã‚Œã‚‹
#====================================
#case "${TERM}" in
#kterm*|xterm*)
#    preexec() {
#        mycmd=(${(s: :)${1}})
#        echo -ne "\ek$mycmd[1]\e\\"
#    }
#    precmd() {
#        echo -ne "\ekidle\e\\"
#    }
#    ;;
#esac


#====================================
# zsh ã‚ªãƒ—ã‚·ãƒ§ãƒ³
#====================================
source ~/.vim/bundle/powerline/powerline/bindings/zsh/powerline.zsh

# ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã®è¨­å®š
bindkey -e                 #Emacsã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã«ã™ã‚‹

setopt auto_cd             # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã®ã¿ã§ç§»å‹•ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
setopt auto_pushd          # ç§»å‹•ã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è‡ªå‹•ã§pushdã—ã¦ãã‚Œã‚‹
setopt correct             # ã‚³ãƒžãƒ³ãƒ‰ã®ãƒŸã‚¹ã‚¿ã‚¤ãƒ—ã‚’è¨‚æ­£ã™ã‚‹ã‹èžã„ã¦ãã‚Œã‚‹
setopt auto_resume         # ã‚µã‚¹ãƒšãƒ³ãƒ‰ä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹ã¨åŒã˜ã‚³ãƒžãƒ³ãƒ‰åã‚’å®Ÿè¡Œã—ãŸå ´åˆã¯ãƒªã‚¸ãƒ¥ãƒ¼ãƒ ã™ã‚‹

# è£œå®Œå‘¨ã‚Šã®è¨­å®š
# - http://voidy21.hatenablog.jp/entry/20090902/1251918174
fpath=($HOME/.zsh.d/zsh-completions/src $fpath)
autoload -U compinit; compinit # è£œå®Œæ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹

setopt auto_menu               # è£œå®Œã‚­ãƒ¼é€£æ‰“ã§è£œå®Œå€™è£œã‚’é †ã«è¡¨ç¤ºã™ã‚‹(d)
setopt auto_list               # è£œå®Œå€™è£œã‚’ä¸€è¦§ã§è¡¨ç¤ºã™ã‚‹(d)
setopt list_packed             # è£œå®Œå€™è£œã®ãƒªã‚¹ãƒˆã‚’ãªã‚‹ã¹ãè©°ã‚ã¦è¡¨ç¤ºã™ã‚‹
setopt list_types              # è£œå®Œå€™è£œã«ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡žã‚‚è¡¨ç¤ºã™ã‚‹
setopt magic_equal_subst       # ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã®å¼•æ•°ã§ --prefix=/usr ãªã©ã® = ä»¥é™ã§ã‚‚è£œå®Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
setopt auto_param_keys         # ã‚«ãƒƒã‚³ã®å¯¾å¿œãªã©ã‚’è‡ªå‹•çš„ã«è£œå®Œã™ã‚‹
setopt auto_param_slash        # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã®è£œå®Œã§æœ«å°¾ã® / ã‚’è‡ªå‹•çš„ã«ä»˜åŠ ã—ã€æ¬¡ã®è£œå®Œã«å‚™ãˆã‚‹
setopt auto_remove_slash       # æœ€å¾ŒãŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã§çµ‚ã‚ã£ã¦ã„ã‚‹å ´åˆæœ«å°¾ã® / ã‚’è‡ªå‹•çš„ã«å–ã‚Šé™¤ã
setopt nolistbeep              # è£œå®Œæ™‚ã®ãƒ“ãƒ¼ãƒ—ã‚’æ­¢ã‚ã‚‹
setopt brace_ccl               #  {a-c} ã‚’ a b c ã«å±•é–‹ã™ã‚‹æ©Ÿèƒ½ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
setopt list_packed             # aliasã‚’è£œå®Œå€™è£œã«å«ã‚ã‚‹

bindkey "\e[Z" reverse-menu-complete                # Shift-Tabã§è£œå®Œå€™è£œã‚’é€†é †ã™ã‚‹
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}' # è£œå®Œæ™‚ã«å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„
zstyle ':completion:*:default' menu select=2        # è£œå®Œå€™è£œã‚’çŸ¢å°ã‚­ãƒ¼ãªã©ã§é¸æŠžã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
zstyle ':completion:*:default' list-colors ""       # è£œå®Œå€™è£œã«è‰²ã‚’ä»˜ã‘ã‚‹ï¼ˆç©ºæ–‡å­—åˆ—ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ã†ã¨ã„ã†æ„å‘³ï¼‰
zstyle ':completion:*' group-name ''                # è£œå®Œæ–¹æ³•æ¯Žã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹ã€‚
zstyle ':completion:*' format '%B%d%b'              # %B...%b: ã€Œ...ã€ã‚’å¤ªå­—ã«ã™ã‚‹ã€‚ %d: è£œå®Œæ–¹æ³•ã®ãƒ©ãƒ™ãƒ«
#zstyle ':completion:*' use-cache yes                # è£œå®Œå€™è£œã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã€‚
zstyle ':completion:*' verbose yes                  # è©³ç´°ãªæƒ…å ±ã‚’ä½¿ã†ã€‚
setopt complete_in_word                             # ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã§è£œå®Œã™ã‚‹ã€‚
setopt globdots                                     # æ˜Žç¢ºãªãƒ‰ãƒƒãƒˆã®æŒ‡å®šãªã—ã§.ã‹ã‚‰å§‹ã¾ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒžãƒƒãƒ
setopt glob_complete                                # globã‚’å±•é–‹ã—ãªã„ã§å€™è£œã®ä¸€è¦§ã‹ã‚‰è£œå®Œã™ã‚‹ã€‚
setopt extended_glob                                # æ‹¡å¼µã‚°ãƒ­ãƒ–ã§è£œå®Œ(~ã¨ã‹^ã¨ã‹ã€‚ä¾‹ãˆã°less *.txt~memo.txt ãªã‚‰memo.txt ä»¥å¤–ã® *.txt ã«ãƒžãƒƒãƒ)
setopt hist_expand                                  # è£œå®Œæ™‚ã«ãƒ’ã‚¹ãƒˆãƒªã‚’è‡ªå‹•çš„ã«å±•é–‹ã™ã‚‹ã€‚
setopt no_beep                                      # è£œå®Œå€™è£œãŒãªã„ã¨ããªã©ã«ãƒ“ãƒ¼ãƒ—éŸ³ã‚’é³´ã‚‰ã•ãªã„ã€‚
#setopt numeric_glob_sort                            # è¾žæ›¸é †ã§ã¯ãªãæ•°å­—é †ã«ä¸¦ã¹ã‚‹ã€‚

## è£œå®Œæ–¹æ³•ã®è¨­å®šã€‚æŒ‡å®šã—ãŸé †ç•ªã«å®Ÿè¡Œã™ã‚‹ã€‚
#### _oldlist å‰å›žã®è£œå®Œçµæžœã‚’å†åˆ©ç”¨ã™ã‚‹ã€‚
#### _complete: è£œå®Œã™ã‚‹ã€‚
#### _match: globã‚’å±•é–‹ã—ãªã„ã§å€™è£œã®ä¸€è¦§ã‹ã‚‰è£œå®Œã™ã‚‹ã€‚
#### _history: ãƒ’ã‚¹ãƒˆãƒªã®ã‚³ãƒžãƒ³ãƒ‰ã‚‚è£œå®Œå€™è£œã¨ã™ã‚‹ã€‚
#### _ignored: è£œå®Œå€™è£œã«ã ã•ãªã„ã¨æŒ‡å®šã—ãŸã‚‚ã®ã‚‚è£œå®Œå€™è£œã¨ã™ã‚‹ã€‚
#### _approximate: ä¼¼ã¦ã„ã‚‹è£œå®Œå€™è£œã‚‚è£œå®Œå€™è£œã¨ã™ã‚‹ã€‚
#### _prefix: ã‚«ãƒ¼ã‚½ãƒ«ä»¥é™ã‚’ç„¡è¦–ã—ã¦ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã¾ã§ã§è£œå®Œã™ã‚‹ã€‚
zstyle ':completion:*' completer _oldlist _complete _match _history _ignored _approximate _prefix

# sudo ã™ã‚‹ã¨ãã‚‚è£œå®ŒãŒåŠ¹ãã‚ˆã†ã«ã™ã‚‹
#zstyle ':completion:sudo:*' environ PATH = "$SUDO_PATH:$PATH"
zstyle ':completion:*:sudo:*' command-path /usr/local/sbin /usr/local/bin \
                                           /usr/sbin /usr/bin /sbin /bin /usr/X11R6/bin \
                                           /usr/local/git/bin

#----------------------------------------
# ãƒ’ã‚¹ãƒˆãƒªå‘¨ã‚Šã®è¨­å®š
#----------------------------------------
setopt share_history        # ä»–ã®ã‚·ã‚§ãƒ«ã®ã‚³ãƒžãƒ³ãƒ‰å±¥æ­´ã‚’å…±æœ‰ã™ã‚‹
setopt append_history       # è¤‡æ•°ã® zsh ã‚’åŒæ™‚ã«ä½¿ã†æ™‚ãªã© history ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸Šæ›¸ãã›ãšè¿½åŠ ã™ã‚‹
setopt hist_ignore_dups     # ç›´å‰ã¨åŒã˜ã‚³ãƒžãƒ³ãƒ‰ã¯ãƒ’ã‚¹ãƒˆãƒªã«æ®‹ã•ãªã„
setopt hist_ignore_all_dups # é‡è«·ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ãŒè¨˜éŒ²ã•ã‚Œã‚‹ã¨ãå¤ã„æ–¹ã‚’å‰Šé™¤ã™ã‚‹
setopt hist_reduce_blanks   # ä½™åˆ†ãªã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦ãƒ’ã‚¹ãƒˆãƒªã«ä¿å­˜ã™ã‚‹
setopt hist_save_no_dups    # ãƒ’ã‚¹ãƒˆãƒªãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã™ã¨ãå¤ã„ã‚³ãƒžãƒ³ãƒ‰ã¨åŒã˜ç‰©ã‚’ç„¡è¦–ã™ã‚‹
setopt extended_history     # ãƒ’ã‚¹ãƒˆãƒªãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã ã‘ã§ã¯ãªãå®Ÿè¡Œæ™‚åˆ»ã¨å®Ÿè¡Œæ™‚é–“ã‚‚ä¿å­˜ã™ã‚‹
setopt inc_append_history   # ã™ãã«ãƒ’ã‚¹ãƒˆãƒªãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½è¨˜ã™ã‚‹ã€‚

#------------------------------------------------------------
# ã‚³ãƒžãƒ³ãƒ‰å±¥æ­´æ¤œç´¢ã®è¨­å®š
# - http://news.mynavi.jp/column/zsh/004/index.html
#
# ã‚³ãƒžãƒ³ãƒ‰ã®å…¥åŠ›é€”ä¸­ã§Ctrl+Pã‚’å…¥åŠ›ã™ã‚‹ã¨å…¥åŠ›å±¥æ­´ã‹ã‚‰
# è©²å½“ã™ã‚‹ç‰©ã‚’é †æ¬¡è¡¨ç¤ºã™ã‚‹
#------------------------------------------------------------
autoload history-search-end

zle -N history-beginning-search-backward-end history-search-end
zle -N history-beginning-search-forward-end history-search-end
bindkey "^P" history-beginning-search-backward-end
bindkey "^N" history-beginning-search-forward-end

# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã®è‰²æŒ‡å®šã‚’åå‰ã§ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
autoload -Uz colors
colors

autoload -Uz is-at-least    # zshã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ç”¨é–¢æ•°ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹

# precmdã«å¯¾ã—ã¦hookã‚’ç°¡å˜ã«ç™»éŒ²ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
# - http://d.hatena.ne.jp/kiririmode/20120327/p1
autoload -Uz add-zsh-hook

#------------------------------------------------------------
# VCSå‘¨ã‚Šã®è¨­å®š
# - http://mollifier.hatenablog.com/entry/20100906/p1
#------------------------------------------------------------
# formatã§æŒ‡å®šã§ãã‚‹å€¤ã«ã¤ã„ã¦
#%s ã©ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ã‚’è¡¨ã™ï¼ˆgitã¨ã‹svnã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ï¼‰
#%b ãƒ–ãƒ©ãƒ³ãƒæƒ…å ±ã‚’è¡¨ã™
#%R ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹ã‚’è¡¨ã™
#%r ãƒªãƒã‚¸ãƒˆãƒªåã‚’è¡¨ã™
#%S ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰è¦‹ãŸã€ä»Šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç›¸å¯¾ãƒ‘ã‚¹ã‚’è¡¨ã™
#%c stagedstrã‚’è¡¨ã™
#%u unstagedstrã‚’è¡¨ã™
#------------------------------------------------------------
autoload -Uz vcs_info

zstyle ':vcs_info:*' enable git svn hg bzr
zstyle ':vcs_info:*' formats '(%s)-[%b]'
zstyle ':vcs_info:*' actionformats '(%s)-[%b|%a]'
zstyle ':vcs_info:(svn|bzr):*' branchformat '%b:r%r'
zstyle ':vcs_info:bzr:*' use-simple true

if is-at-least 4.3.10; then
    zstyle ':vcs_info:git:*' check-for-changes true
    zstyle ':vcs_info:git:*' stagedstr "+"
    zstyle ':vcs_info:git:*' unstagedstr "-"
    zstyle ':vcs_info:git:*' formats '(%s)-[%b] %c%u'
    zstyle ':vcs_info:git:*' actionformats '(%s)-[%b|%a] %c%u'
fi

# vcs_infoã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°ã™ã‚‹
function _update_vcs_info_msg() {
    psvar=()
    LANG=en_US.UTF-8 vcs_info
    [[ -n "$vcs_info_msg_0_" ]] && psvar[1]="$vcs_info_msg_0_"
}

# ã‚³ãƒžãƒ³ãƒ‰ã®å®Ÿè¡Œå‰ã«ä¸Šã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ãŸã‚ã®ãƒ•ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹
add-zsh-hook precmd _update_vcs_info_msg

# antigen.zsh setting
source ~/.zsh.d/antigen/antigen.zsh
antigen bundle zsh-users/zsh-syntax-highlighting
antigen apply

## auto-fu.zsh
# precompiled source
function () { # precompile
    local A
    A=~/.zsh.d/auto-fu.zsh/auto-fu.zsh
    [[ -e "${A:r}.zwc" ]] && [[ "$A" -ot "${A:r}.zwc" ]] ||
    zsh -c "source $A; auto-fu-zcompile $A ${A:h}" >/dev/null 2>&1
}

source ~/.zsh.d/auto-fu.zsh/auto-fu && auto-fu-install
zstyle ':auto-fu:highlight' input bold
zstyle ':auto-fu:highlight' completion fg=black,bold
zstyle ':auto-fu:highlight' completion/one fg=white,bold,underline
zstyle ':auto-fu:var' postdisplay $'\n-auto-fu-'
zstyle ':auto-fu:var' track-keymap-skip opp
zle-line-init () {auto-fu-init;}; zle -N zle-line-init
zle -N zle-keymap-select auto-fu-zle-keymap-select


function () {
    local code
    code=${functions[auto-fu-init]/'\n-azfu-'/''}
    eval "function auto-fu-init () { $code }"
    code=${functions[auto-fu]/fg=black,bold/fg=white}
    eval "function auto-fu () { $code }"
}

function afu+cancel () {
    afu-clearing-maybe
    ((afu_in_p == 1)) && { afu_in_p=0; BUFFER="$buffer_cur" }
}
function bindkey-advice-before () {
    local key="$1"
    local advice="$2"
    local widget="$3"
    [[ -z "$widget" ]] && {
        local -a bind
        bind=(`bindkey -M main "$key"`)
        widget=$bind[2]
    }
    local fun="$advice"
    if [[ "$widget" != "undefined-key" ]]; then
        local code=${"$(<=(cat <<"EOT"
            function $advice-$widget () {
                zle $advice
                zle $widget
            }
            fun="$advice-$widget"
EOT
        ))"}
        eval "${${${code//\$widget/$widget}//\$key/$key}//\$advice/$advice}"
    fi
    zle -N "$fun"
    bindkey -M afu "$key" "$fun"
}
bindkey-advice-before "^G" afu+cancel
bindkey-advice-before "^[" afu+cancel
bindkey-advice-before "^J" afu+cancel afu+accept-line

source $HOME/dotfiles/shell.d/alias.sh
source $HOME/dotfiles/shell.d/complete.sh

# å€‹åˆ¥è¨­å®šç”¨
if [ -e $HOME/.zshrc.local ]; then
  source $HOME/.zshrc.local
fi
